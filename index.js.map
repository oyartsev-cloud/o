{"version":3,"file":"index.js","sources":["../src/main.js"],"sourcesContent":["import * as api from './js/api.js';\n\nconst EXERCISES_PER_PAGE = 10;\nconst QUOTE_STORAGE_KEY = 'your-energy-quote';\nconst FAVORITES_STORAGE_KEY = 'your-energy-favorites';\nconst EMAIL_REGEX = /^\\w+(\\.\\w+)?@[a-zA-Z_]+?\\.[a-zA-Z]{2,3}$/;\nconst FILTER_PARAM_MAP = {\n  Muscles: 'muscles',\n  'Body parts': 'bodypart',\n  Equipment: 'equipment',\n};\n\nconst elements = {\n  quoteText: document.querySelector('[data-quote-text]'),\n  quoteAuthor: document.querySelector('[data-quote-author]'),\n  filterTabs: document.querySelectorAll('[data-filter-tab]'),\n  filterCategories: document.querySelector('[data-filter-categories]'),\n  categoriesBlock: document.querySelector('[data-categories-block]'),\n  exercisesSection: document.querySelector('.exercises-section'),\n  exercisesTitle: document.querySelector('[data-exercises-title]'),\n  searchForm: document.querySelector('[data-search-form]'),\n  searchInput: document.querySelector('[data-search-input]'),\n  exercisesList: document.querySelector('[data-exercises-list]'),\n  pagination: document.querySelector('[data-pagination]'),\n  modalBackdrop: document.querySelector('[data-modal-backdrop]'),\n  modalContent: document.querySelector('[data-modal-content]'),\n  modalClose: document.querySelector('[data-modal-close]'),\n  subscriptionForm: document.querySelector('[data-subscription-form]'),\n  subscriptionSuccess: document.querySelector('[data-subscription-success]'),\n  subscriptionError: document.querySelector('[data-subscription-error]'),\n  ratingModalBackdrop: document.querySelector('[data-rating-modal-backdrop]'),\n  ratingForm: document.querySelector('[data-rating-form]'),\n  ratingError: document.querySelector('[data-rating-error]'),\n};\n\nlet state = {\n  activeFilterType: 'Muscles',\n  activeCategory: null,\n  keyword: '',\n  currentPage: 1,\n  totalPages: 1,\n  filtersData: [],\n  exercisesData: { results: [], page: 1, totalPages: 1 },\n  modalExerciseId: null,\n  ratingExerciseId: null,\n};\n\nfunction renderQuote(quote) {\n  if (!elements.quoteText || !elements.quoteAuthor) return;\n  elements.quoteText.textContent = quote.quote;\n  elements.quoteAuthor.textContent = quote.author;\n}\n\nfunction getExercisesParams() {\n  const params = { page: state.currentPage, limit: EXERCISES_PER_PAGE };\n  if (state.keyword) params.keyword = state.keyword;\n  const paramKey = FILTER_PARAM_MAP[state.activeFilterType];\n  if (paramKey && state.activeCategory) params[paramKey] = state.activeCategory;\n  return params;\n}\n\nfunction updateCategoriesVsExercisesView() {\n  if (elements.categoriesBlock) elements.categoriesBlock.hidden = !!state.activeCategory;\n  if (elements.exercisesSection) elements.exercisesSection.hidden = !state.activeCategory;\n  if (elements.exercisesTitle) elements.exercisesTitle.textContent = state.activeCategory ? `Exercises: ${state.activeCategory}` : '';\n}\n\nfunction renderFilterCategories() {\n  if (!elements.filterCategories) return;\n  elements.filterCategories.innerHTML = !state.filtersData.length\n    ? '<li class=\"filter-categories-empty\">No categories for this filter.</li>'\n    : state.filtersData\n    .map(\n      item => `\n    <li class=\"filter-category-item ${state.activeCategory === item.name ? 'active' : ''}\">\n      <button type=\"button\" class=\"filter-category-btn\" data-category-name=\"${escapeAttr(item.name)}\">\n        <img src=\"${escapeAttr(item.imgURL)}\" alt=\"${escapeAttr(item.name)}\" loading=\"lazy\" />\n        <span class=\"filter-category-name\">${escapeHtml(item.name)}</span>\n      </button>\n    </li>\n  `\n    )\n    .join('');\n\n  elements.filterCategories.querySelectorAll('.filter-category-btn').forEach(btn => {\n    btn.addEventListener('click', () => {\n      const name = btn.getAttribute('data-category-name');\n      state.activeCategory = name;\n      state.currentPage = 1;\n      loadFilters(state.activeFilterType);\n      loadExercises();\n      updateCategoriesVsExercisesView();\n    });\n  });\n  updateCategoriesVsExercisesView();\n}\n\nfunction escapeAttr(str) {\n  const div = document.createElement('div');\n  div.textContent = str;\n  return div.innerHTML.replace(/\"/g, '&quot;');\n}\n\nfunction escapeHtml(str) {\n  const div = document.createElement('div');\n  div.textContent = str;\n  return div.innerHTML;\n}\n\nfunction renderStars(rating, interactive = false, exerciseId = null) {\n  const value = Math.round(Number(rating)) || 0;\n  let html = '';\n  for (let i = 1; i <= 5; i++) {\n    const filled = i <= value;\n    if (interactive && exerciseId) {\n      html += `<button type=\"button\" class=\"modal-exercise-star-btn ${filled ? 'filled' : ''}\" data-rating=\"${i}\" data-exercise-id=\"${escapeAttr(exerciseId)}\">★</button>`;\n    } else {\n      html += `<span class=\"exercise-card-rating-star ${filled ? 'filled' : ''}\">★</span>`;\n    }\n  }\n  return html;\n}\n\nfunction renderExerciseCard(exercise) {\n  const ratingHtml = renderStars(exercise.rating, false);\n  return `\n    <li class=\"exercise-card\">\n      <img class=\"exercise-card-image\" src=\"${escapeAttr(exercise.gifUrl)}\" alt=\"${escapeAttr(exercise.name)}\" loading=\"lazy\" />\n      <div class=\"exercise-card-body\">\n        <h3 class=\"exercise-card-name\">${escapeHtml(exercise.name)}</h3>\n        <div class=\"exercise-card-rating\">${ratingHtml}</div>\n        <p class=\"exercise-card-meta\">\n          <span>${escapeHtml(exercise.bodyPart)}</span>\n          <span>${escapeHtml(exercise.target)}</span>\n        </p>\n        <div class=\"exercise-card-footer\">\n          <span class=\"exercise-card-calories\">${exercise.burnedCalories} cal</span>\n          <span class=\"exercise-card-time\">${exercise.time} min</span>\n          <button type=\"button\" class=\"exercise-card-start\" data-exercise-id=\"${escapeAttr(exercise._id)}\">Start</button>\n        </div>\n      </div>\n    </li>\n  `;\n}\n\nfunction renderExercisesList() {\n  if (!elements.exercisesList) return;\n  const { results } = state.exercisesData;\n  if (!results.length) {\n    elements.exercisesList.innerHTML = '<li class=\"exercises-empty\">No exercises found. Try another filter or search.</li>';\n    return;\n  }\n  elements.exercisesList.innerHTML = results.map(renderExerciseCard).join('');\n  elements.exercisesList.querySelectorAll('.exercise-card-start').forEach(btn => {\n    btn.addEventListener('click', () => openModal(btn.getAttribute('data-exercise-id')));\n  });\n}\n\nfunction renderPagination() {\n  if (!elements.pagination) return;\n  const { page, totalPages } = state.exercisesData;\n  if (totalPages <= 1) {\n    elements.pagination.innerHTML = '';\n    return;\n  }\n  const parts = [];\n  const addPage = (p) => {\n    parts.push(\n      `<button type=\"button\" class=\"pagination-btn ${p === page ? 'active' : ''}\" data-page=\"${p}\">${p}</button>`\n    );\n  };\n  if (totalPages <= 7) {\n    for (let i = 1; i <= totalPages; i++) addPage(i);\n  } else {\n    addPage(1);\n    if (page > 3) parts.push('<span class=\"pagination-ellipsis\">...</span>');\n    const start = Math.max(2, page - 1);\n    const end = Math.min(totalPages - 1, page + 1);\n    for (let i = start; i <= end; i++) addPage(i);\n    if (page < totalPages - 2) parts.push('<span class=\"pagination-ellipsis\">...</span>');\n    if (totalPages > 1) addPage(totalPages);\n  }\n  elements.pagination.innerHTML = parts.join('');\n  elements.pagination.querySelectorAll('.pagination-btn').forEach(btn => {\n    btn.addEventListener('click', () => {\n      state.currentPage = Number(btn.getAttribute('data-page'));\n      loadExercises();\n    });\n  });\n}\n\nfunction getFavorites() {\n  try {\n    return JSON.parse(localStorage.getItem(FAVORITES_STORAGE_KEY) || '[]');\n  } catch {\n    return [];\n  }\n}\n\nfunction addFavorite(exercise) {\n  const list = getFavorites();\n  if (list.some((e) => e._id === exercise._id)) return;\n  list.push(exercise);\n  localStorage.setItem(FAVORITES_STORAGE_KEY, JSON.stringify(list));\n}\n\nfunction removeFavorite(id) {\n  const list = getFavorites().filter((e) => e._id !== id);\n  localStorage.setItem(FAVORITES_STORAGE_KEY, JSON.stringify(list));\n}\n\nfunction isFavorite(id) {\n  return getFavorites().some((e) => e._id === id);\n}\n\nfunction getDateKey() {\n  const d = new Date();\n  return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;\n}\n\nasync function loadQuote() {\n  const today = getDateKey();\n  try {\n    const stored = localStorage.getItem(QUOTE_STORAGE_KEY);\n    if (stored) {\n      const data = JSON.parse(stored);\n      if (data.date === today && data.quote) {\n        renderQuote({ quote: data.quote, author: data.author || '' });\n        return;\n      }\n    }\n    const quote = await api.getQuote();\n    renderQuote(quote);\n    localStorage.setItem(QUOTE_STORAGE_KEY, JSON.stringify({ date: today, quote: quote.quote, author: quote.author }));\n  } catch {\n    if (elements.quoteText) elements.quoteText.textContent = 'Failed to load quote.';\n    if (elements.quoteAuthor) elements.quoteAuthor.textContent = '';\n  }\n}\n\nasync function loadFilters(filterType) {\n  state.activeFilterType = filterType;\n  try {\n    const data = await api.getFilters(filterType);\n    state.filtersData = data.results || [];\n    renderFilterCategories();\n  } catch {\n    state.filtersData = [];\n    renderFilterCategories();\n  }\n}\n\nasync function loadExercises() {\n  const params = getExercisesParams();\n  try {\n    const data = await api.getExercises(params);\n    state.exercisesData = { results: data.results || [], page: data.page || 1, totalPages: data.totalPages || 1 };\n  } catch {\n    state.exercisesData = { results: [], page: 1, totalPages: 1 };\n  }\n  renderExercisesList();\n  renderPagination();\n  updateCategoriesVsExercisesView();\n}\n\nlet modalCloseHandlers = null;\n\nfunction openModal(exerciseId) {\n  state.modalExerciseId = exerciseId;\n  if (!elements.modalBackdrop || !elements.modalContent) return;\n  elements.modalContent.innerHTML = '<div class=\"modal-loading\">Loading...</div>';\n  elements.modalBackdrop.hidden = false;\n  document.body.style.overflow = 'hidden';\n\n  const onClose = () => {\n    if (modalCloseHandlers) {\n      elements.modalClose?.removeEventListener('click', modalCloseHandlers.onCloseClick);\n      elements.modalBackdrop?.removeEventListener('click', modalCloseHandlers.onBackdropClick);\n      document.removeEventListener('keydown', modalCloseHandlers.onEscape);\n      modalCloseHandlers = null;\n    }\n    elements.modalBackdrop.hidden = true;\n    document.body.style.overflow = '';\n    state.modalExerciseId = null;\n  };\n\n  modalCloseHandlers = {\n    onCloseClick: onClose,\n    onBackdropClick: (e) => { if (e.target === elements.modalBackdrop) onClose(); },\n    onEscape: (e) => { if (e.key === 'Escape') onClose(); },\n  };\n  elements.modalClose?.addEventListener('click', modalCloseHandlers.onCloseClick);\n  elements.modalBackdrop?.addEventListener('click', modalCloseHandlers.onBackdropClick);\n  document.addEventListener('keydown', modalCloseHandlers.onEscape);\n\n  api.getExerciseById(exerciseId).then(\n    (exercise) => {\n      const fav = isFavorite(exercise._id);\n      const videoBlock = exercise.videoUrl\n        ? `<video class=\"modal-exercise-video\" src=\"${escapeAttr(exercise.videoUrl)}\" controls></video>`\n        : '';\n      const popularityVal = exercise.popularity != null ? exercise.popularity : '';\n      elements.modalContent.innerHTML = `\n        ${videoBlock}\n        <img class=\"modal-exercise-image\" src=\"${escapeAttr(exercise.gifUrl)}\" alt=\"${escapeAttr(exercise.name)}\" />\n        <h2 class=\"modal-exercise-name\" id=\"modal-title\">${escapeHtml(exercise.name)}</h2>\n        <div class=\"modal-exercise-rating-wrap\">\n          <span class=\"modal-exercise-rating-label\">Rating</span>\n          <div class=\"modal-exercise-stars\" data-modal-stars>${renderStars(exercise.rating, false)}</div>\n        </div>\n        <p class=\"modal-exercise-meta\">\n          <span>${escapeHtml(exercise.bodyPart)}</span> • <span>${escapeHtml(exercise.target)}</span> • <span>${escapeHtml(exercise.equipment)}</span><br />\n          ${popularityVal ? `Popularity: ${popularityVal}<br />` : ''}\n          ${exercise.burnedCalories} cal • ${exercise.time} min\n        </p>\n        <p class=\"modal-exercise-description\">${escapeHtml(exercise.description || '')}</p>\n        <button type=\"button\" class=\"modal-exercise-fav\" data-modal-fav data-exercise-id=\"${escapeAttr(exercise._id)}\">${fav ? 'Remove from Favorites' : 'Add to Favorites'}</button>\n        <button type=\"button\" class=\"modal-exercise-give-rating\" data-modal-give-rating data-exercise-id=\"${escapeAttr(exercise._id)}\">Give a rating</button>\n      `;\n      const favBtn = elements.modalContent.querySelector('[data-modal-fav]');\n      if (favBtn) {\n        favBtn.addEventListener('click', () => {\n          if (isFavorite(exercise._id)) {\n            removeFavorite(exercise._id);\n            favBtn.textContent = 'Add to Favorites';\n          } else {\n            addFavorite(exercise);\n            favBtn.textContent = 'Remove from Favorites';\n          }\n        });\n      }\n      const giveRatingBtn = elements.modalContent.querySelector('[data-modal-give-rating]');\n      if (giveRatingBtn) {\n        giveRatingBtn.addEventListener('click', () => {\n          onClose();\n          openRatingModal(exercise._id);\n        });\n      }\n    },\n    () => {\n      elements.modalContent.innerHTML = '<div class=\"modal-loading\">Failed to load exercise.</div>';\n    }\n  );\n}\n\nfunction closeModal() {\n  if (modalCloseHandlers) {\n    elements.modalClose?.removeEventListener('click', modalCloseHandlers.onCloseClick);\n    elements.modalBackdrop?.removeEventListener('click', modalCloseHandlers.onBackdropClick);\n    document.removeEventListener('keydown', modalCloseHandlers.onEscape);\n    modalCloseHandlers = null;\n  }\n  if (!elements.modalBackdrop) return;\n  elements.modalBackdrop.hidden = true;\n  document.body.style.overflow = '';\n  state.modalExerciseId = null;\n}\n\nfunction openRatingModal(exerciseId) {\n  state.ratingExerciseId = exerciseId;\n  const backdrop = elements.ratingModalBackdrop;\n  const form = elements.ratingForm;\n  if (!backdrop || !form) return;\n  form.reset();\n  if (elements.ratingError) elements.ratingError.hidden = true;\n  backdrop.hidden = false;\n  document.body.style.overflow = 'hidden';\n}\n\nfunction closeRatingModal() {\n  const backdrop = elements.ratingModalBackdrop;\n  if (!backdrop) return;\n  backdrop.hidden = true;\n  document.body.style.overflow = '';\n  if (state.ratingExerciseId && elements.modalBackdrop) {\n    openModal(state.ratingExerciseId);\n  }\n  state.ratingExerciseId = null;\n}\n\nfunction initRatingModal() {\n  state.ratingExerciseId = null;\n  const backdrop = elements.ratingModalBackdrop;\n  const closeBtn = document.querySelector('[data-rating-modal-close]');\n  if (closeBtn) closeBtn.addEventListener('click', closeRatingModal);\n  if (backdrop) backdrop.addEventListener('click', (e) => { if (e.target === backdrop) closeRatingModal(); });\n  document.addEventListener('keydown', (e) => { if (e.key === 'Escape' && backdrop && !backdrop.hidden) closeRatingModal(); });\n  if (elements.ratingForm) {\n    elements.ratingForm.addEventListener('submit', async (e) => {\n      e.preventDefault();\n      const emailEl = elements.ratingForm.querySelector('[data-rating-email]');\n      const email = (emailEl?.value || '').trim();\n      const ratingEl = elements.ratingForm.querySelector('input[name=\"rating\"]:checked');\n      const rating = ratingEl ? Number(ratingEl.value) : 0;\n      if (!EMAIL_REGEX.test(email)) {\n        if (elements.ratingError) {\n          elements.ratingError.textContent = 'Enter a valid email (e.g. user@domain.com)';\n          elements.ratingError.hidden = false;\n        }\n        return;\n      }\n      if (rating < 1 || rating > 5) {\n        if (elements.ratingError) {\n          elements.ratingError.textContent = 'Please select a rating.';\n          elements.ratingError.hidden = false;\n        }\n        return;\n      }\n      if (elements.ratingError) elements.ratingError.hidden = true;\n      try {\n        await api.patchExerciseRating(state.ratingExerciseId, rating);\n        closeRatingModal();\n      } catch (err) {\n        if (elements.ratingError) {\n          elements.ratingError.textContent = err.message || 'Failed to submit rating.';\n          elements.ratingError.hidden = false;\n        }\n      }\n    });\n  }\n}\n\nfunction initFilters() {\n  elements.filterTabs.forEach((tab) => {\n    tab.addEventListener('click', () => {\n      const filterType = tab.getAttribute('data-filter-tab');\n      elements.filterTabs.forEach((t) => {\n        t.classList.remove('active');\n        t.setAttribute('aria-selected', 'false');\n      });\n      tab.classList.add('active');\n      tab.setAttribute('aria-selected', 'true');\n      state.activeCategory = null;\n      state.currentPage = 1;\n      loadFilters(filterType);\n      updateCategoriesVsExercisesView();\n    });\n  });\n}\n\nfunction initSearch() {\n  if (!elements.searchForm) return;\n  elements.searchForm.addEventListener('submit', (e) => {\n    e.preventDefault();\n    state.keyword = (elements.searchInput?.value || '').trim();\n    state.currentPage = 1;\n    loadExercises();\n  });\n}\n\nfunction initModal() {\n  /* Close listeners are added in openModal and removed in closeModal to prevent memory leaks */\n}\n\nfunction initSubscription() {\n  if (!elements.subscriptionForm) return;\n  elements.subscriptionForm.addEventListener('submit', async (e) => {\n    e.preventDefault();\n    const form = e.target;\n    const emailInput = form.querySelector('input[name=\"email\"]');\n    const email = (emailInput?.value || '').trim();\n    if (!email) return;\n    if (!EMAIL_REGEX.test(email)) {\n      if (elements.subscriptionError) {\n        elements.subscriptionError.textContent = 'Enter a valid email (e.g. user@domain.com)';\n        elements.subscriptionError.hidden = false;\n      }\n      return;\n    }\n    if (elements.subscriptionSuccess) elements.subscriptionSuccess.hidden = true;\n    if (elements.subscriptionError) {\n      elements.subscriptionError.hidden = true;\n      elements.subscriptionError.textContent = '';\n    }\n    try {\n      await api.postSubscription(email);\n      if (elements.subscriptionSuccess) elements.subscriptionSuccess.hidden = false;\n      form.reset();\n    } catch (err) {\n      if (elements.subscriptionError) {\n        elements.subscriptionError.textContent = err.message || 'Subscription failed. Try again.';\n        elements.subscriptionError.hidden = false;\n      }\n    }\n  });\n}\n\nfunction initHeader() {\n  const burger = document.querySelector('[data-burger]');\n  const menu = document.querySelector('[data-header-menu]');\n  if (burger && menu) {\n    burger.addEventListener('click', () => {\n      const open = menu.classList.toggle('is-open');\n      burger.setAttribute('aria-expanded', open);\n    });\n    menu.querySelectorAll('.header__nav-link').forEach((link) => {\n      link.addEventListener('click', () => {\n        menu.classList.remove('is-open');\n        burger.setAttribute('aria-expanded', 'false');\n      });\n    });\n  }\n  const path = window.location.pathname;\n  document.querySelectorAll('.header__nav-link').forEach((a) => {\n    const isCurrent = (a.getAttribute('href') === './index.html' && !path.includes('favorites')) ||\n      (a.getAttribute('href') === './favorites.html' && path.includes('favorites'));\n    a.classList.toggle('header__nav-link--current', isCurrent);\n  });\n}\n\nfunction init() {\n  loadQuote();\n  loadFilters('Muscles');\n  updateCategoriesVsExercisesView();\n  initFilters();\n  initSearch();\n  initModal();\n  initRatingModal();\n  initSubscription();\n  initHeader();\n}\n\ninit();\n"],"names":["EXERCISES_PER_PAGE","QUOTE_STORAGE_KEY","FAVORITES_STORAGE_KEY","EMAIL_REGEX","FILTER_PARAM_MAP","elements","state","renderQuote","quote","getExercisesParams","params","paramKey","updateCategoriesVsExercisesView","renderFilterCategories","item","escapeAttr","escapeHtml","btn","name","loadFilters","loadExercises","str","div","renderStars","rating","interactive","exerciseId","value","html","i","filled","renderExerciseCard","exercise","ratingHtml","renderExercisesList","results","openModal","renderPagination","page","totalPages","parts","addPage","p","start","end","getFavorites","addFavorite","list","e","removeFavorite","id","isFavorite","getDateKey","d","loadQuote","today","stored","data","api.getQuote","filterType","api.getFilters","api.getExercises","modalCloseHandlers","onClose","_a","_b","api.getExerciseById","fav","videoBlock","popularityVal","favBtn","giveRatingBtn","openRatingModal","backdrop","form","closeRatingModal","initRatingModal","closeBtn","emailEl","email","ratingEl","api.patchExerciseRating","err","initFilters","tab","t","initSearch","initSubscription","emailInput","api.postSubscription","initHeader","burger","menu","open","link","path","a","isCurrent","init"],"mappings":"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"}